---
title: "A2: Cluster Analysis"
author: "Harshali Singh, Vishal Mehta"
output: 
  html_document:
    toc: true
    theme: united
---
###Implementation

Our MapReduce program consists of the following 3 parts :

1. Driver
2. Mapper
3. Reducer

####Driver:
The Driver code initializes the job and instructs the Hadoop platform to execute the code on a set of input files, and controls where the output files are placed. The command line parameters that we have have passed to the Driver program are the paths to the directory containing the input files and the path to the output directory. Both these path locations are from the HDFS. If the output location already exists the program will exit with an error.

Here we have also configured different properties such as Mapper, Reducer, Output Key & Value types for the Mapper, Output Key & Value types for the Reducer.

####Mapper:
The FlightMapper code reads the input files as <Key,Value> pairs and emits key value pairs. The FlightMapper class extends Mapper class which expects four generics, which define the types of the input and output key/value pairs. The first two parameters define the input key and value types, the second two define the output key and value types.

The map() function reads each line and only emits <Key, Value> of flights in 2015. The output Key of FlightMapper is a Text consisting of Carrier Code and Month
The ouput Value of FlightMapper is a Text consisting of Count of flights and Average Ticket Price computed in each file.

e.g. <"AA" 1, 100 120.0112>
     <"AA" 1, 2346 545.2304>
     <"AA" 1, 3879 512.6789>

####Reducer:
The Reducer code reads the outputs generated by the mapper as <Key,Value> pairs and emits key value pairs. The Reducer class extends Reducer class which expects four generics, which define the types of the input and output key/value pairs. The first two parameters define the intermediate key and value types, the second two define the final output key and value types.

The reduce() function receives a key as well as an iterator over all the values associated with the key.

The output Key of FlightMapper is a Text consisting of Carrier Code and Month
The ouput Value of FlightMapper is a Text consisting of Count of flights and Average Ticket Price across all flights active in 2015.

e.g. <"AA" 1, 43971 530.1824>

Assumption: We have only considered Average Ticket Prices for 2015 flights.


```{r, echo=FALSE}

library(ggplot2)

#Read the output file
table = read.table("finalOutput", sep="\t",col.names=c("Carrier", "Month", "Count", "Avg_Price"))

#Sort the data and fetch top 10 flights based on count
sorted_df <- table[order(-table$Count),]
top10 <- sorted_df[1:10,]

top10$Month <- month.abb[top10$Month]

```

###Graph Plot

We are using R to plot the average ticket price for each month and for each flight.

Here is a plot of flight carriers with the most flights overall which were active in Year 2015. The data consisted of only January month.

```{r}

#Plot the average ticket price for each month for each airline
p <- ggplot(top10, aes(Carrier, Avg_Price)) + geom_point()
p + facet_grid(. ~ Month)
ggsave(filname="plot.png")
```



